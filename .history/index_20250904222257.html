<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="经典贪吃蛇游戏 - 支持桌面和移动端">
    <meta name="keywords" content="贪吃蛇,游戏,HTML5,Canvas">
    <title>贪吃蛇游戏</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #333;
        }

        .game-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            max-width: 90vw;
            max-height: 90vh;
        }

        .game-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .game-header h1 {
            color: #4a5568;
            margin-bottom: 10px;
            font-size: 2em;
        }

        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            align-items: center;
            margin-bottom: 20px;
        }

        .score-display {
            display: flex;
            gap: 20px;
            font-weight: bold;
            color: #2d3748;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            background: #4299e1;
            color: white;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }

        .btn:hover {
            background: #3182ce;
            transform: translateY(-1px);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn.danger {
            background: #e53e3e;
        }

        .btn.danger:hover {
            background: #c53030;
        }

        .canvas-container {
            position: relative;
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }

        #gameCanvas {
            border: 3px solid #4a5568;
            border-radius: 8px;
            background: #f7fafc;
        }

        .game-over {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            border-radius: 8px;
        }

        .game-over h2 {
            font-size: 2.5em;
            margin-bottom: 20px;
            color: #ff6b6b;
        }

        .game-over p {
            font-size: 1.2em;
            margin-bottom: 10px;
        }

        .settings {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
            align-items: center;
        }

        .setting-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .setting-group label {
            font-weight: bold;
            color: #4a5568;
        }

        .setting-group select {
            padding: 4px 8px;
            border: 1px solid #cbd5e0;
            border-radius: 4px;
            background: white;
        }

        .instructions {
            margin-top: 20px;
            padding: 15px;
            background: #edf2f7;
            border-radius: 8px;
            font-size: 14px;
            line-height: 1.5;
        }

        .instructions h3 {
            margin-bottom: 10px;
            color: #2d3748;
        }

        .instructions-toggle {
            background: none;
            border: none;
            color: #4299e1;
            cursor: pointer;
            text-decoration: underline;
            font-size: 14px;
        }

        .instructions-content {
            display: none;
            margin-top: 10px;
        }

        .instructions-content.show {
            display: block;
        }

        @media (max-width: 768px) {
            .game-container {
                padding: 15px;
            }

            .controls {
                flex-direction: column;
                gap: 15px;
            }

            .score-display {
                flex-direction: column;
                gap: 5px;
                text-align: center;
            }

            .settings {
                flex-direction: column;
                gap: 10px;
            }

            .game-header h1 {
                font-size: 1.5em;
            }
        }

        @media (prefers-reduced-motion: reduce) {
            .btn {
                transition: none;
            }
            
            .btn:hover {
                transform: none;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="game-header">
            <h1>🐍 贪吃蛇游戏</h1>
        </div>

        <div class="controls">
            <div class="score-display">
                <div>分数: <span id="score">0</span></div>
                <div>最高分: <span id="highScore">0</span></div>
                <div>速度: <span id="speed">1</span></div>
            </div>
            
            <button class="btn" id="pauseBtn" aria-label="暂停游戏">暂停</button>
            <button class="btn danger" id="restartBtn" aria-label="重新开始">重新开始</button>
            <button class="btn" id="clearScoreBtn" aria-label="清空最高分">清空记录</button>
        </div>

        <div class="canvas-container">
            <canvas id="gameCanvas" width="400" height="400"></canvas>
            <div class="game-over" id="gameOver">
                <h2>游戏结束!</h2>
                <p>本局得分: <span id="finalScore">0</span></p>
                <p>最高分: <span id="finalHighScore">0</span></p>
                <button class="btn" id="restartBtn2" aria-label="重新开始游戏">重新开始</button>
            </div>
        </div>

        <div class="settings">
            <div class="setting-group">
                <label for="gridSize">网格大小:</label>
                <select id="gridSize">
                    <option value="16">16×16</option>
                    <option value="20" selected>20×20</option>
                    <option value="24">24×24</option>
                </select>
            </div>
            
            <div class="setting-group">
                <label for="wallMode">边界模式:</label>
                <select id="wallMode">
                    <option value="wall">撞墙即死</option>
                    <option value="wrap">穿墙模式</option>
                </select>
            </div>
        </div>

        <div class="instructions">
            <button class="instructions-toggle" id="instructionsToggle">📖 使用说明</button>
            <div class="instructions-content" id="instructionsContent">
                <h3>操作方式:</h3>
                <p>• 桌面端: 方向键 ↑↓←→ 或 WASD 控制方向</p>
                <p>• 移动端: 在屏幕上滑动控制方向</p>
                <p>• 空格键: 暂停/继续游戏</p>
                
                <h3>游戏规则:</h3>
                <p>• 控制蛇吃食物，每吃一个食物得10分并增长</p>
                <p>• 撞到自己或墙壁(撞墙模式下)游戏结束</p>
                <p>• 每吃5个食物速度会增加</p>
                
                <h3>设置说明:</h3>
                <p>• 网格大小: 改变游戏区域大小</p>
                <p>• 边界模式: 选择撞墙死亡或穿墙传送</p>
                <p>• 清空记录: 重置最高分记录</p>
            </div>
        </div>
    </div>

    <script>
        // 游戏配置常量
        const CONFIG = {
            INITIAL_SPEED: 150,        // 初始速度(ms)
            SPEED_INCREASE: 10,        // 每次加速减少的ms
            MIN_SPEED: 80,             // 最小速度(ms)
            FOODS_PER_SPEED_UP: 5,     // 每吃几个食物加速一次
            POINTS_PER_FOOD: 10        // 每个食物的分数
        };

        // 游戏状态
        class SnakeGame {
            constructor() {
                this.canvas = document.getElementById('gameCanvas');
                this.ctx = this.canvas.getContext('2d');
                this.gridSize = 20;
                this.tileCount = 20;
                this.wallMode = 'wall'; // 'wall' or 'wrap'
                
                this.snake = [{x: 10, y: 10}];
                this.food = {x: 15, y: 15};
                this.dx = 0;
                this.dy = 0;
                this.nextDirection = {dx: 0, dy: 0};
                
                this.score = 0;
                this.speed = 1;
                this.gameRunning = false;
                this.gamePaused = false;
                this.lastTime = 0;
                this.gameSpeed = CONFIG.INITIAL_SPEED;
                
                this.touchStartX = 0;
                this.touchStartY = 0;
                
                this.initializeGame();
                this.setupEventListeners();
                this.loadSettings();
                this.updateDisplay();
            }

            initializeGame() {
                this.resizeCanvas();
                this.generateFood();
                this.draw();
            }

            resizeCanvas() {
                const container = this.canvas.parentElement;
                const maxSize = Math.min(container.clientWidth - 40, container.clientHeight - 40, 500);
                this.canvas.width = maxSize;
                this.canvas.height = maxSize;
                this.gridSize = maxSize / this.tileCount;
            }

            setupEventListeners() {
                // 键盘事件
                document.addEventListener('keydown', (e) => this.handleKeyPress(e));
                
                // 触摸事件
                this.canvas.addEventListener('touchstart', (e) => this.handleTouchStart(e), {passive: false});
                this.canvas.addEventListener('touchmove', (e) => e.preventDefault(), {passive: false});
                this.canvas.addEventListener('touchend', (e) => this.handleTouchEnd(e), {passive: false});
                
                // 按钮事件
                document.getElementById('pauseBtn').addEventListener('click', () => this.togglePause());
                document.getElementById('restartBtn').addEventListener('click', () => this.restart());
                document.getElementById('restartBtn2').addEventListener('click', () => this.restart());
                document.getElementById('clearScoreBtn').addEventListener('click', () => this.clearHighScore());
                
                // 设置事件
                document.getElementById('gridSize').addEventListener('change', (e) => this.changeGridSize(e.target.value));
                document.getElementById('wallMode').addEventListener('change', (e) => this.changeWallMode(e.target.value));
                
                // 说明书切换
                document.getElementById('instructionsToggle').addEventListener('click', () => this.toggleInstructions());
                
                // 窗口大小变化
                window.addEventListener('resize', () => this.resizeCanvas());
            }

            handleKeyPress(e) {
                if (e.code === 'Space') {
                    e.preventDefault();
                    this.togglePause();
                    return;
                }
                
                if (!this.gameRunning || this.gamePaused) return;
                
                let newDx = this.dx, newDy = this.dy;
                
                switch(e.key) {
                    case 'ArrowUp':
                    case 'w':
                    case 'W':
                        if (this.dy !== 1) { newDx = 0; newDy = -1; }
                        break;
                    case 'ArrowDown':
                    case 's':
                    case 'S':
                        if (this.dy !== -1) { newDx = 0; newDy = 1; }
                        break;
                    case 'ArrowLeft':
                    case 'a':
                    case 'A':
                        if (this.dx !== 1) { newDx = -1; newDy = 0; }
                        break;
                    case 'ArrowRight':
                    case 'd':
                    case 'D':
                        if (this.dx !== -1) { newDx = 1; newDy = 0; }
                        break;
                }
                
                this.nextDirection = {dx: newDx, dy: newDy};
            }

            handleTouchStart(e) {
                e.preventDefault();
                const touch = e.touches[0];
                this.touchStartX = touch.clientX;
                this.touchStartY = touch.clientY;
            }

            handleTouchEnd(e) {
                e.preventDefault();
                if (!this.gameRunning || this.gamePaused) {
                    if (!this.gameRunning) this.start();
                    return;
                }
                
                const touch = e.changedTouches[0];
                const deltaX = touch.clientX - this.touchStartX;
                const deltaY = touch.clientY - this.touchStartY;
                const minSwipeDistance = 30;
                
                if (Math.abs(deltaX) < minSwipeDistance && Math.abs(deltaY) < minSwipeDistance) return;
                
                let newDx = this.dx, newDy = this.dy;
                
                if (Math.abs(deltaX) > Math.abs(deltaY)) {
                    // 水平滑动
                    if (deltaX > 0 && this.dx !== -1) { newDx = 1; newDy = 0; }
                    else if (deltaX < 0 && this.dx !== 1) { newDx = -1; newDy = 0; }
                } else {
                    // 垂直滑动
                    if (deltaY > 0 && this.dy !== -1) { newDx = 0; newDy = 1; }
                    else if (deltaY < 0 && this.dy !== 1) { newDx = 0; newDy = -1; }
                }
                
                this.nextDirection = {dx: newDx, dy: newDy};
            }

            start() {
                if (this.gameRunning) return;
                
                this.gameRunning = true;
                this.gamePaused = false;
                this.dx = 1;
                this.dy = 0;
                this.nextDirection = {dx: 1, dy: 0};
                document.getElementById('pauseBtn').textContent = '暂停';
                document.getElementById('gameOver').style.display = 'none';
                
                this.gameLoop();
            }

            togglePause() {
                if (!this.gameRunning) {
                    this.start();
                    return;
                }
                
                this.gamePaused = !this.gamePaused;
                document.getElementById('pauseBtn').textContent = this.gamePaused ? '继续' : '暂停';
                
                if (!this.gamePaused) {
                    this.gameLoop();
                }
            }

            restart() {
                this.gameRunning = false;
                this.gamePaused = false;
                this.snake = [{x: 10, y: 10}];
                this.dx = 0;
                this.dy = 0;
                this.nextDirection = {dx: 0, dy: 0};
                this.score = 0;
                this.speed = 1;
                this.gameSpeed = CONFIG.INITIAL_SPEED;
                
                this.generateFood();
                this.updateDisplay();
                this.draw();
                
                document.getElementById('pauseBtn').textContent = '开始';
                document.getElementById('gameOver').style.display = 'none';
            }

            gameLoop() {
                if (!this.gameRunning || this.gamePaused) return;
                
                const currentTime = Date.now();
                if (currentTime - this.lastTime >= this.gameSpeed) {
                    this.update();
                    this.draw();
                    this.lastTime = currentTime;
                }
                
                requestAnimationFrame(() => this.gameLoop());
            }

            update() {
                // 应用下一个方向
                this.dx = this.nextDirection.dx;
                this.dy = this.nextDirection.dy;
                
                // 移动蛇头
                const head = {x: this.snake[0].x + this.dx, y: this.snake[0].y + this.dy};
                
                // 边界处理
                if (this.wallMode === 'wrap') {
                    if (head.x < 0) head.x = this.tileCount - 1;
                    if (head.x >= this.tileCount) head.x = 0;
                    if (head.y < 0) head.y = this.tileCount - 1;
                    if (head.y >= this.tileCount) head.y = 0;
                } else {
                    if (head.x < 0 || head.x >= this.tileCount || head.y < 0 || head.y >= this.tileCount) {
                        this.gameOver();
                        return;
                    }
                }
                
                // 检查自撞
                if (this.snake.some(segment => segment.x === head.x && segment.y === head.y)) {
                    this.gameOver();
                    return;
                }
                
                this.snake.unshift(head);
                
                // 检查是否吃到食物
                if (head.x === this.food.x && head.y === this.food.y) {
                    this.score += CONFIG.POINTS_PER_FOOD;
                    
                    // 增加速度
                    if (this.score % (CONFIG.FOODS_PER_SPEED_UP * CONFIG.POINTS_PER_FOOD) === 0) {
                        this.gameSpeed = Math.max(this.gameSpeed - CONFIG.SPEED_INCREASE, CONFIG.MIN_SPEED);
                        this.speed = Math.floor((CONFIG.INITIAL_SPEED - this.gameSpeed) / CONFIG.SPEED_INCREASE) + 1;
                    }
                    
                    this.generateFood();
                    this.updateDisplay();
                } else {
                    this.snake.pop();
                }
            }

            generateFood() {
                let attempts = 0;
                do {
                    this.food = {
                        x: Math.floor(Math.random() * this.tileCount),
                        y: Math.floor(Math.random() * this.tileCount)
                    };
                    attempts++;
                } while (this.snake.some(segment => segment.x === this.food.x && segment.y === this.food.y) && attempts < 100);
            }

            draw() {
                // 清空画布
                this.ctx.fillStyle = '#f7fafc';
                this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
                
                // 绘制网格线
                this.ctx.strokeStyle = '#e2e8f0';
                this.ctx.lineWidth = 1;
                for (let i = 0; i <= this.tileCount; i++) {
                    const pos = i * this.gridSize;
                    this.ctx.beginPath();
                    this.ctx.moveTo(pos, 0);
                    this.ctx.lineTo(pos, this.canvas.height);
                    this.ctx.moveTo(0, pos);
                    this.ctx.lineTo(this.canvas.width, pos);
                    this.ctx.stroke();
                }
                
                // 绘制蛇
                this.snake.forEach((segment, index) => {
                    this.ctx.fillStyle = index === 0 ? '#2d5a27' : '#48bb78';
                    this.ctx.fillRect(
                        segment.x * this.gridSize + 1,
                        segment.y * this.gridSize + 1,
                        this.gridSize - 2,
                        this.gridSize - 2
                    );
                });
                
                // 绘制食物
                this.ctx.fillStyle = '#e53e3e';
                this.ctx.beginPath();
                this.ctx.arc(
                    this.food.x * this.gridSize + this.gridSize / 2,
                    this.food.y * this.gridSize + this.gridSize / 2,
                    this.gridSize / 2 - 2,
                    0,
                    2 * Math.PI
                );
                this.ctx.fill();
            }

            gameOver() {
                this.gameRunning = false;
                
                // 更新最高分
                const highScore = this.getHighScore();
                if (this.score > highScore) {
                    localStorage.setItem('snakeHighScore', this.score.toString());
                }
                
                // 显示游戏结束界面
                document.getElementById('finalScore').textContent = this.score;
                document.getElementById('finalHighScore').textContent = Math.max(this.score, highScore);
                document.getElementById('gameOver').style.display = 'flex';
                
                this.updateDisplay();
            }

            getHighScore() {
                return parseInt(localStorage.getItem('snakeHighScore') || '0');
            }

            clearHighScore() {
                localStorage.removeItem('snakeHighScore');
                this.updateDisplay();
            }

            updateDisplay() {
                document.getElementById('score').textContent = this.score;
                document.getElementById('highScore').textContent = this.getHighScore();
                document.getElementById('speed').textContent = this.speed;
            }

            changeGridSize(size) {
                this.tileCount = parseInt(size);
                this.saveSettings();
                this.resizeCanvas();
                this.restart();
            }

            changeWallMode(mode) {
                this.wallMode = mode;
                this.saveSettings();
            }

            saveSettings() {
                const settings = {
                    gridSize: this.tileCount,
                    wallMode: this.wallMode
                };
                localStorage.setItem('snakeSettings', JSON.stringify(settings));
            }

            loadSettings() {
                const settings = JSON.parse(localStorage.getItem('snakeSettings') || '{}');
                
                if (settings.gridSize) {
                    this.tileCount = settings.gridSize;
                    document.getElementById('gridSize').value = settings.gridSize;
                }
                
                if (settings.wallMode) {
                    this.wallMode = settings.wallMode;
                    document.getElementById('wallMode').value = settings.wallMode;
                }
                
                this.resizeCanvas();
            }

            toggleInstructions() {
                const content = document.getElementById('instructionsContent');
                const toggle = document.getElementById('instructionsToggle');
                
                content.classList.toggle('show');
                toggle.textContent = content.classList.contains('show') ? '📖 隐藏说明' : '📖 使用说明';
            }
        }

        // 初始化游戏
        const game = new SnakeGame();

        // 可选扩展 TODO:
        // - 添加音效和背景音乐
        // - 实现不同皮肤主题
        // - 添加障碍物和道具系统
        // - 实现多人对战模式
        // - 添加关卡系统和特殊挑战
        // - 实现排行榜和成就系统
        // - 添加粒子效果和动画
        // - 支持自定义控制键位
    </script>
</body>
</html>
