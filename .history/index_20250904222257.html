<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="ç»å…¸è´ªåƒè›‡æ¸¸æˆ - æ”¯æŒæ¡Œé¢å’Œç§»åŠ¨ç«¯">
    <meta name="keywords" content="è´ªåƒè›‡,æ¸¸æˆ,HTML5,Canvas">
    <title>è´ªåƒè›‡æ¸¸æˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #333;
        }

        .game-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            max-width: 90vw;
            max-height: 90vh;
        }

        .game-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .game-header h1 {
            color: #4a5568;
            margin-bottom: 10px;
            font-size: 2em;
        }

        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            align-items: center;
            margin-bottom: 20px;
        }

        .score-display {
            display: flex;
            gap: 20px;
            font-weight: bold;
            color: #2d3748;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            background: #4299e1;
            color: white;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }

        .btn:hover {
            background: #3182ce;
            transform: translateY(-1px);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn.danger {
            background: #e53e3e;
        }

        .btn.danger:hover {
            background: #c53030;
        }

        .canvas-container {
            position: relative;
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }

        #gameCanvas {
            border: 3px solid #4a5568;
            border-radius: 8px;
            background: #f7fafc;
        }

        .game-over {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            border-radius: 8px;
        }

        .game-over h2 {
            font-size: 2.5em;
            margin-bottom: 20px;
            color: #ff6b6b;
        }

        .game-over p {
            font-size: 1.2em;
            margin-bottom: 10px;
        }

        .settings {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
            align-items: center;
        }

        .setting-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .setting-group label {
            font-weight: bold;
            color: #4a5568;
        }

        .setting-group select {
            padding: 4px 8px;
            border: 1px solid #cbd5e0;
            border-radius: 4px;
            background: white;
        }

        .instructions {
            margin-top: 20px;
            padding: 15px;
            background: #edf2f7;
            border-radius: 8px;
            font-size: 14px;
            line-height: 1.5;
        }

        .instructions h3 {
            margin-bottom: 10px;
            color: #2d3748;
        }

        .instructions-toggle {
            background: none;
            border: none;
            color: #4299e1;
            cursor: pointer;
            text-decoration: underline;
            font-size: 14px;
        }

        .instructions-content {
            display: none;
            margin-top: 10px;
        }

        .instructions-content.show {
            display: block;
        }

        @media (max-width: 768px) {
            .game-container {
                padding: 15px;
            }

            .controls {
                flex-direction: column;
                gap: 15px;
            }

            .score-display {
                flex-direction: column;
                gap: 5px;
                text-align: center;
            }

            .settings {
                flex-direction: column;
                gap: 10px;
            }

            .game-header h1 {
                font-size: 1.5em;
            }
        }

        @media (prefers-reduced-motion: reduce) {
            .btn {
                transition: none;
            }
            
            .btn:hover {
                transform: none;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="game-header">
            <h1>ğŸ è´ªåƒè›‡æ¸¸æˆ</h1>
        </div>

        <div class="controls">
            <div class="score-display">
                <div>åˆ†æ•°: <span id="score">0</span></div>
                <div>æœ€é«˜åˆ†: <span id="highScore">0</span></div>
                <div>é€Ÿåº¦: <span id="speed">1</span></div>
            </div>
            
            <button class="btn" id="pauseBtn" aria-label="æš‚åœæ¸¸æˆ">æš‚åœ</button>
            <button class="btn danger" id="restartBtn" aria-label="é‡æ–°å¼€å§‹">é‡æ–°å¼€å§‹</button>
            <button class="btn" id="clearScoreBtn" aria-label="æ¸…ç©ºæœ€é«˜åˆ†">æ¸…ç©ºè®°å½•</button>
        </div>

        <div class="canvas-container">
            <canvas id="gameCanvas" width="400" height="400"></canvas>
            <div class="game-over" id="gameOver">
                <h2>æ¸¸æˆç»“æŸ!</h2>
                <p>æœ¬å±€å¾—åˆ†: <span id="finalScore">0</span></p>
                <p>æœ€é«˜åˆ†: <span id="finalHighScore">0</span></p>
                <button class="btn" id="restartBtn2" aria-label="é‡æ–°å¼€å§‹æ¸¸æˆ">é‡æ–°å¼€å§‹</button>
            </div>
        </div>

        <div class="settings">
            <div class="setting-group">
                <label for="gridSize">ç½‘æ ¼å¤§å°:</label>
                <select id="gridSize">
                    <option value="16">16Ã—16</option>
                    <option value="20" selected>20Ã—20</option>
                    <option value="24">24Ã—24</option>
                </select>
            </div>
            
            <div class="setting-group">
                <label for="wallMode">è¾¹ç•Œæ¨¡å¼:</label>
                <select id="wallMode">
                    <option value="wall">æ’å¢™å³æ­»</option>
                    <option value="wrap">ç©¿å¢™æ¨¡å¼</option>
                </select>
            </div>
        </div>

        <div class="instructions">
            <button class="instructions-toggle" id="instructionsToggle">ğŸ“– ä½¿ç”¨è¯´æ˜</button>
            <div class="instructions-content" id="instructionsContent">
                <h3>æ“ä½œæ–¹å¼:</h3>
                <p>â€¢ æ¡Œé¢ç«¯: æ–¹å‘é”® â†‘â†“â†â†’ æˆ– WASD æ§åˆ¶æ–¹å‘</p>
                <p>â€¢ ç§»åŠ¨ç«¯: åœ¨å±å¹•ä¸Šæ»‘åŠ¨æ§åˆ¶æ–¹å‘</p>
                <p>â€¢ ç©ºæ ¼é”®: æš‚åœ/ç»§ç»­æ¸¸æˆ</p>
                
                <h3>æ¸¸æˆè§„åˆ™:</h3>
                <p>â€¢ æ§åˆ¶è›‡åƒé£Ÿç‰©ï¼Œæ¯åƒä¸€ä¸ªé£Ÿç‰©å¾—10åˆ†å¹¶å¢é•¿</p>
                <p>â€¢ æ’åˆ°è‡ªå·±æˆ–å¢™å£(æ’å¢™æ¨¡å¼ä¸‹)æ¸¸æˆç»“æŸ</p>
                <p>â€¢ æ¯åƒ5ä¸ªé£Ÿç‰©é€Ÿåº¦ä¼šå¢åŠ </p>
                
                <h3>è®¾ç½®è¯´æ˜:</h3>
                <p>â€¢ ç½‘æ ¼å¤§å°: æ”¹å˜æ¸¸æˆåŒºåŸŸå¤§å°</p>
                <p>â€¢ è¾¹ç•Œæ¨¡å¼: é€‰æ‹©æ’å¢™æ­»äº¡æˆ–ç©¿å¢™ä¼ é€</p>
                <p>â€¢ æ¸…ç©ºè®°å½•: é‡ç½®æœ€é«˜åˆ†è®°å½•</p>
            </div>
        </div>
    </div>

    <script>
        // æ¸¸æˆé…ç½®å¸¸é‡
        const CONFIG = {
            INITIAL_SPEED: 150,        // åˆå§‹é€Ÿåº¦(ms)
            SPEED_INCREASE: 10,        // æ¯æ¬¡åŠ é€Ÿå‡å°‘çš„ms
            MIN_SPEED: 80,             // æœ€å°é€Ÿåº¦(ms)
            FOODS_PER_SPEED_UP: 5,     // æ¯åƒå‡ ä¸ªé£Ÿç‰©åŠ é€Ÿä¸€æ¬¡
            POINTS_PER_FOOD: 10        // æ¯ä¸ªé£Ÿç‰©çš„åˆ†æ•°
        };

        // æ¸¸æˆçŠ¶æ€
        class SnakeGame {
            constructor() {
                this.canvas = document.getElementById('gameCanvas');
                this.ctx = this.canvas.getContext('2d');
                this.gridSize = 20;
                this.tileCount = 20;
                this.wallMode = 'wall'; // 'wall' or 'wrap'
                
                this.snake = [{x: 10, y: 10}];
                this.food = {x: 15, y: 15};
                this.dx = 0;
                this.dy = 0;
                this.nextDirection = {dx: 0, dy: 0};
                
                this.score = 0;
                this.speed = 1;
                this.gameRunning = false;
                this.gamePaused = false;
                this.lastTime = 0;
                this.gameSpeed = CONFIG.INITIAL_SPEED;
                
                this.touchStartX = 0;
                this.touchStartY = 0;
                
                this.initializeGame();
                this.setupEventListeners();
                this.loadSettings();
                this.updateDisplay();
            }

            initializeGame() {
                this.resizeCanvas();
                this.generateFood();
                this.draw();
            }

            resizeCanvas() {
                const container = this.canvas.parentElement;
                const maxSize = Math.min(container.clientWidth - 40, container.clientHeight - 40, 500);
                this.canvas.width = maxSize;
                this.canvas.height = maxSize;
                this.gridSize = maxSize / this.tileCount;
            }

            setupEventListeners() {
                // é”®ç›˜äº‹ä»¶
                document.addEventListener('keydown', (e) => this.handleKeyPress(e));
                
                // è§¦æ‘¸äº‹ä»¶
                this.canvas.addEventListener('touchstart', (e) => this.handleTouchStart(e), {passive: false});
                this.canvas.addEventListener('touchmove', (e) => e.preventDefault(), {passive: false});
                this.canvas.addEventListener('touchend', (e) => this.handleTouchEnd(e), {passive: false});
                
                // æŒ‰é’®äº‹ä»¶
                document.getElementById('pauseBtn').addEventListener('click', () => this.togglePause());
                document.getElementById('restartBtn').addEventListener('click', () => this.restart());
                document.getElementById('restartBtn2').addEventListener('click', () => this.restart());
                document.getElementById('clearScoreBtn').addEventListener('click', () => this.clearHighScore());
                
                // è®¾ç½®äº‹ä»¶
                document.getElementById('gridSize').addEventListener('change', (e) => this.changeGridSize(e.target.value));
                document.getElementById('wallMode').addEventListener('change', (e) => this.changeWallMode(e.target.value));
                
                // è¯´æ˜ä¹¦åˆ‡æ¢
                document.getElementById('instructionsToggle').addEventListener('click', () => this.toggleInstructions());
                
                // çª—å£å¤§å°å˜åŒ–
                window.addEventListener('resize', () => this.resizeCanvas());
            }

            handleKeyPress(e) {
                if (e.code === 'Space') {
                    e.preventDefault();
                    this.togglePause();
                    return;
                }
                
                if (!this.gameRunning || this.gamePaused) return;
                
                let newDx = this.dx, newDy = this.dy;
                
                switch(e.key) {
                    case 'ArrowUp':
                    case 'w':
                    case 'W':
                        if (this.dy !== 1) { newDx = 0; newDy = -1; }
                        break;
                    case 'ArrowDown':
                    case 's':
                    case 'S':
                        if (this.dy !== -1) { newDx = 0; newDy = 1; }
                        break;
                    case 'ArrowLeft':
                    case 'a':
                    case 'A':
                        if (this.dx !== 1) { newDx = -1; newDy = 0; }
                        break;
                    case 'ArrowRight':
                    case 'd':
                    case 'D':
                        if (this.dx !== -1) { newDx = 1; newDy = 0; }
                        break;
                }
                
                this.nextDirection = {dx: newDx, dy: newDy};
            }

            handleTouchStart(e) {
                e.preventDefault();
                const touch = e.touches[0];
                this.touchStartX = touch.clientX;
                this.touchStartY = touch.clientY;
            }

            handleTouchEnd(e) {
                e.preventDefault();
                if (!this.gameRunning || this.gamePaused) {
                    if (!this.gameRunning) this.start();
                    return;
                }
                
                const touch = e.changedTouches[0];
                const deltaX = touch.clientX - this.touchStartX;
                const deltaY = touch.clientY - this.touchStartY;
                const minSwipeDistance = 30;
                
                if (Math.abs(deltaX) < minSwipeDistance && Math.abs(deltaY) < minSwipeDistance) return;
                
                let newDx = this.dx, newDy = this.dy;
                
                if (Math.abs(deltaX) > Math.abs(deltaY)) {
                    // æ°´å¹³æ»‘åŠ¨
                    if (deltaX > 0 && this.dx !== -1) { newDx = 1; newDy = 0; }
                    else if (deltaX < 0 && this.dx !== 1) { newDx = -1; newDy = 0; }
                } else {
                    // å‚ç›´æ»‘åŠ¨
                    if (deltaY > 0 && this.dy !== -1) { newDx = 0; newDy = 1; }
                    else if (deltaY < 0 && this.dy !== 1) { newDx = 0; newDy = -1; }
                }
                
                this.nextDirection = {dx: newDx, dy: newDy};
            }

            start() {
                if (this.gameRunning) return;
                
                this.gameRunning = true;
                this.gamePaused = false;
                this.dx = 1;
                this.dy = 0;
                this.nextDirection = {dx: 1, dy: 0};
                document.getElementById('pauseBtn').textContent = 'æš‚åœ';
                document.getElementById('gameOver').style.display = 'none';
                
                this.gameLoop();
            }

            togglePause() {
                if (!this.gameRunning) {
                    this.start();
                    return;
                }
                
                this.gamePaused = !this.gamePaused;
                document.getElementById('pauseBtn').textContent = this.gamePaused ? 'ç»§ç»­' : 'æš‚åœ';
                
                if (!this.gamePaused) {
                    this.gameLoop();
                }
            }

            restart() {
                this.gameRunning = false;
                this.gamePaused = false;
                this.snake = [{x: 10, y: 10}];
                this.dx = 0;
                this.dy = 0;
                this.nextDirection = {dx: 0, dy: 0};
                this.score = 0;
                this.speed = 1;
                this.gameSpeed = CONFIG.INITIAL_SPEED;
                
                this.generateFood();
                this.updateDisplay();
                this.draw();
                
                document.getElementById('pauseBtn').textContent = 'å¼€å§‹';
                document.getElementById('gameOver').style.display = 'none';
            }

            gameLoop() {
                if (!this.gameRunning || this.gamePaused) return;
                
                const currentTime = Date.now();
                if (currentTime - this.lastTime >= this.gameSpeed) {
                    this.update();
                    this.draw();
                    this.lastTime = currentTime;
                }
                
                requestAnimationFrame(() => this.gameLoop());
            }

            update() {
                // åº”ç”¨ä¸‹ä¸€ä¸ªæ–¹å‘
                this.dx = this.nextDirection.dx;
                this.dy = this.nextDirection.dy;
                
                // ç§»åŠ¨è›‡å¤´
                const head = {x: this.snake[0].x + this.dx, y: this.snake[0].y + this.dy};
                
                // è¾¹ç•Œå¤„ç†
                if (this.wallMode === 'wrap') {
                    if (head.x < 0) head.x = this.tileCount - 1;
                    if (head.x >= this.tileCount) head.x = 0;
                    if (head.y < 0) head.y = this.tileCount - 1;
                    if (head.y >= this.tileCount) head.y = 0;
                } else {
                    if (head.x < 0 || head.x >= this.tileCount || head.y < 0 || head.y >= this.tileCount) {
                        this.gameOver();
                        return;
                    }
                }
                
                // æ£€æŸ¥è‡ªæ’
                if (this.snake.some(segment => segment.x === head.x && segment.y === head.y)) {
                    this.gameOver();
                    return;
                }
                
                this.snake.unshift(head);
                
                // æ£€æŸ¥æ˜¯å¦åƒåˆ°é£Ÿç‰©
                if (head.x === this.food.x && head.y === this.food.y) {
                    this.score += CONFIG.POINTS_PER_FOOD;
                    
                    // å¢åŠ é€Ÿåº¦
                    if (this.score % (CONFIG.FOODS_PER_SPEED_UP * CONFIG.POINTS_PER_FOOD) === 0) {
                        this.gameSpeed = Math.max(this.gameSpeed - CONFIG.SPEED_INCREASE, CONFIG.MIN_SPEED);
                        this.speed = Math.floor((CONFIG.INITIAL_SPEED - this.gameSpeed) / CONFIG.SPEED_INCREASE) + 1;
                    }
                    
                    this.generateFood();
                    this.updateDisplay();
                } else {
                    this.snake.pop();
                }
            }

            generateFood() {
                let attempts = 0;
                do {
                    this.food = {
                        x: Math.floor(Math.random() * this.tileCount),
                        y: Math.floor(Math.random() * this.tileCount)
                    };
                    attempts++;
                } while (this.snake.some(segment => segment.x === this.food.x && segment.y === this.food.y) && attempts < 100);
            }

            draw() {
                // æ¸…ç©ºç”»å¸ƒ
                this.ctx.fillStyle = '#f7fafc';
                this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
                
                // ç»˜åˆ¶ç½‘æ ¼çº¿
                this.ctx.strokeStyle = '#e2e8f0';
                this.ctx.lineWidth = 1;
                for (let i = 0; i <= this.tileCount; i++) {
                    const pos = i * this.gridSize;
                    this.ctx.beginPath();
                    this.ctx.moveTo(pos, 0);
                    this.ctx.lineTo(pos, this.canvas.height);
                    this.ctx.moveTo(0, pos);
                    this.ctx.lineTo(this.canvas.width, pos);
                    this.ctx.stroke();
                }
                
                // ç»˜åˆ¶è›‡
                this.snake.forEach((segment, index) => {
                    this.ctx.fillStyle = index === 0 ? '#2d5a27' : '#48bb78';
                    this.ctx.fillRect(
                        segment.x * this.gridSize + 1,
                        segment.y * this.gridSize + 1,
                        this.gridSize - 2,
                        this.gridSize - 2
                    );
                });
                
                // ç»˜åˆ¶é£Ÿç‰©
                this.ctx.fillStyle = '#e53e3e';
                this.ctx.beginPath();
                this.ctx.arc(
                    this.food.x * this.gridSize + this.gridSize / 2,
                    this.food.y * this.gridSize + this.gridSize / 2,
                    this.gridSize / 2 - 2,
                    0,
                    2 * Math.PI
                );
                this.ctx.fill();
            }

            gameOver() {
                this.gameRunning = false;
                
                // æ›´æ–°æœ€é«˜åˆ†
                const highScore = this.getHighScore();
                if (this.score > highScore) {
                    localStorage.setItem('snakeHighScore', this.score.toString());
                }
                
                // æ˜¾ç¤ºæ¸¸æˆç»“æŸç•Œé¢
                document.getElementById('finalScore').textContent = this.score;
                document.getElementById('finalHighScore').textContent = Math.max(this.score, highScore);
                document.getElementById('gameOver').style.display = 'flex';
                
                this.updateDisplay();
            }

            getHighScore() {
                return parseInt(localStorage.getItem('snakeHighScore') || '0');
            }

            clearHighScore() {
                localStorage.removeItem('snakeHighScore');
                this.updateDisplay();
            }

            updateDisplay() {
                document.getElementById('score').textContent = this.score;
                document.getElementById('highScore').textContent = this.getHighScore();
                document.getElementById('speed').textContent = this.speed;
            }

            changeGridSize(size) {
                this.tileCount = parseInt(size);
                this.saveSettings();
                this.resizeCanvas();
                this.restart();
            }

            changeWallMode(mode) {
                this.wallMode = mode;
                this.saveSettings();
            }

            saveSettings() {
                const settings = {
                    gridSize: this.tileCount,
                    wallMode: this.wallMode
                };
                localStorage.setItem('snakeSettings', JSON.stringify(settings));
            }

            loadSettings() {
                const settings = JSON.parse(localStorage.getItem('snakeSettings') || '{}');
                
                if (settings.gridSize) {
                    this.tileCount = settings.gridSize;
                    document.getElementById('gridSize').value = settings.gridSize;
                }
                
                if (settings.wallMode) {
                    this.wallMode = settings.wallMode;
                    document.getElementById('wallMode').value = settings.wallMode;
                }
                
                this.resizeCanvas();
            }

            toggleInstructions() {
                const content = document.getElementById('instructionsContent');
                const toggle = document.getElementById('instructionsToggle');
                
                content.classList.toggle('show');
                toggle.textContent = content.classList.contains('show') ? 'ğŸ“– éšè—è¯´æ˜' : 'ğŸ“– ä½¿ç”¨è¯´æ˜';
            }
        }

        // åˆå§‹åŒ–æ¸¸æˆ
        const game = new SnakeGame();

        // å¯é€‰æ‰©å±• TODO:
        // - æ·»åŠ éŸ³æ•ˆå’ŒèƒŒæ™¯éŸ³ä¹
        // - å®ç°ä¸åŒçš®è‚¤ä¸»é¢˜
        // - æ·»åŠ éšœç¢ç‰©å’Œé“å…·ç³»ç»Ÿ
        // - å®ç°å¤šäººå¯¹æˆ˜æ¨¡å¼
        // - æ·»åŠ å…³å¡ç³»ç»Ÿå’Œç‰¹æ®ŠæŒ‘æˆ˜
        // - å®ç°æ’è¡Œæ¦œå’Œæˆå°±ç³»ç»Ÿ
        // - æ·»åŠ ç²’å­æ•ˆæœå’ŒåŠ¨ç”»
        // - æ”¯æŒè‡ªå®šä¹‰æ§åˆ¶é”®ä½
    </script>
</body>
</html>
