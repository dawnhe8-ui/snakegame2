<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="ç»å…¸è´ªåƒè›‡æ¸¸æˆ - æ”¯æŒæ¡Œé¢å’Œç§»åŠ¨ç«¯">
    <meta name="keywords" content="è´ªåƒè›‡,æ¸¸æˆ,HTML5,Canvas">
    <title>è´ªåƒè›‡æ¸¸æˆ</title>
    <style>
        /* å…¨å±€æ ·å¼é‡ç½®å’ŒåŸºç¡€è®¾ç½® */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #333;
            overflow-x: hidden;
        }

        /* ä¸»æ¸¸æˆå®¹å™¨æ ·å¼ */
        .game-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            max-width: 90vw;
            max-height: 90vh;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        /* æ¸¸æˆæ ‡é¢˜åŒºåŸŸæ ·å¼ */
        .game-header {
            text-align: center;
            margin-bottom: 20px;
            position: relative;
        }

        .game-header h1 {
            color: #4a5568;
            margin-bottom: 10px;
            font-size: 2em;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
            animation: titleGlow 3s ease-in-out infinite alternate;
        }

        /* æ ‡é¢˜å‘å…‰åŠ¨ç”» */
        @keyframes titleGlow {
            from { text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1); }
            to { text-shadow: 2px 2px 8px rgba(102, 126, 234, 0.3); }
        }

        /* éŸ³æ•ˆæ§åˆ¶æŒ‰é’® */
        .sound-toggle {
            position: absolute;
            top: 0;
            right: 0;
            background: none;
            border: none;
            font-size: 1.5em;
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            transition: all 0.2s;
        }

        .sound-toggle:hover {
            background: rgba(66, 153, 225, 0.1);
            transform: scale(1.1);
        }

        /* æ§åˆ¶é¢æ¿æ ·å¼ */
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px;
            background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
            border-radius: 10px;
            border: 1px solid rgba(203, 213, 224, 0.5);
        }

        /* åˆ†æ•°æ˜¾ç¤ºåŒºåŸŸ */
        .score-display {
            display: flex;
            gap: 20px;
            font-weight: bold;
            color: #2d3748;
        }

        .score-item {
            padding: 8px 12px;
            background: rgba(66, 153, 225, 0.1);
            border-radius: 8px;
            border: 1px solid rgba(66, 153, 225, 0.2);
            transition: all 0.3s ease;
        }

        .score-item:hover {
            background: rgba(66, 153, 225, 0.2);
            transform: translateY(-1px);
        }

        .score-item.highlight {
            animation: scoreHighlight 0.5s ease-in-out;
        }

        /* åˆ†æ•°æ›´æ–°é«˜äº®åŠ¨ç”» */
        @keyframes scoreHighlight {
            0% { background: rgba(72, 187, 120, 0.3); transform: scale(1); }
            50% { background: rgba(72, 187, 120, 0.5); transform: scale(1.05); }
            100% { background: rgba(66, 153, 225, 0.1); transform: scale(1); }
        }

        /* æŒ‰é’®åŸºç¡€æ ·å¼ */
        .btn {
            padding: 10px 18px;
            border: none;
            border-radius: 8px;
            background: linear-gradient(135deg, #4299e1 0%, #3182ce 100%);
            color: white;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:hover {
            background: linear-gradient(135deg, #3182ce 0%, #2c5aa0 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        /* å±é™©æŒ‰é’®æ ·å¼ */
        .btn.danger {
            background: linear-gradient(135deg, #e53e3e 0%, #c53030 100%);
        }

        .btn.danger:hover {
            background: linear-gradient(135deg, #c53030 0%, #9c2626 100%);
        }

        /* æˆåŠŸæŒ‰é’®æ ·å¼ */
        .btn.success {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
        }

        .btn.success:hover {
            background: linear-gradient(135deg, #38a169 0%, #2f855a 100%);
        }

        /* ç”»å¸ƒå®¹å™¨æ ·å¼ */
        .canvas-container {
            position: relative;
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
            padding: 10px;
            background: linear-gradient(135deg, #edf2f7 0%, #e2e8f0 100%);
            border-radius: 12px;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        /* æ¸¸æˆç”»å¸ƒæ ·å¼ */
        #gameCanvas {
            border: 3px solid #4a5568;
            border-radius: 8px;
            background: #f7fafc;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        #gameCanvas:hover {
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        /* æ¸¸æˆçŠ¶æ€æŒ‡ç¤ºå™¨ */
        .game-status {
            position: absolute;
            top: 15px;
            left: 15px;
            padding: 5px 10px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .game-status.show {
            opacity: 1;
        }

        .game-status.playing {
            background: rgba(72, 187, 120, 0.8);
        }

        .game-status.paused {
            background: rgba(237, 137, 54, 0.8);
        }

        /* æ¸¸æˆç»“æŸè¦†ç›–å±‚æ ·å¼ */
        .game-over {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            border-radius: 8px;
            backdrop-filter: blur(5px);
            animation: fadeIn 0.5s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        .game-over h2 {
            font-size: 2.5em;
            margin-bottom: 20px;
            color: #ff6b6b;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .game-over p {
            font-size: 1.2em;
            margin-bottom: 10px;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
        }

        /* ç²’å­æ•ˆæœå®¹å™¨ */
        .particles {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
            border-radius: 8px;
        }

        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: #4299e1;
            border-radius: 50%;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); opacity: 0; }
            50% { transform: translateY(-20px) rotate(180deg); opacity: 1; }
        }

        .settings {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
            align-items: center;
        }

        .setting-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .setting-group label {
            font-weight: bold;
            color: #4a5568;
        }

        .setting-group select {
            padding: 4px 8px;
            border: 1px solid #cbd5e0;
            border-radius: 4px;
            background: white;
        }

        .instructions {
            margin-top: 20px;
            padding: 15px;
            background: #edf2f7;
            border-radius: 8px;
            font-size: 14px;
            line-height: 1.5;
        }

        .instructions h3 {
            margin-bottom: 10px;
            color: #2d3748;
        }

        .instructions-toggle {
            background: none;
            border: none;
            color: #4299e1;
            cursor: pointer;
            text-decoration: underline;
            font-size: 14px;
        }

        .instructions-content {
            display: none;
            margin-top: 10px;
        }

        .instructions-content.show {
            display: block;
        }

        @media (max-width: 768px) {
            .game-container {
                padding: 15px;
            }

            .controls {
                flex-direction: column;
                gap: 15px;
            }

            .score-display {
                flex-direction: column;
                gap: 5px;
                text-align: center;
            }

            .settings {
                flex-direction: column;
                gap: 10px;
            }

            .game-header h1 {
                font-size: 1.5em;
            }
        }

        /* å‡å°‘åŠ¨ç”»åå¥½è®¾ç½® */
        @media (prefers-reduced-motion: reduce) {
            .btn, .score-item, #gameCanvas, .game-status, .instructions-content {
                transition: none;
                animation: none;
            }

            .btn:hover, .score-item:hover {
                transform: none;
            }

            .game-over h2, .particle {
                animation: none;
            }

            .game-header h1 {
                animation: none;
                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
            }

            .instructions-content.show {
                transition: none;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="game-header">
            <h1>ğŸ è´ªåƒè›‡æ¸¸æˆ</h1>
            <button class="sound-toggle" id="soundToggle" aria-label="éŸ³æ•ˆå¼€å…³" title="éŸ³æ•ˆå¼€å…³">ğŸ”Š</button>
        </div>

        <div class="controls">
            <div class="score-display">
                <div class="score-item" id="scoreItem">åˆ†æ•°: <span id="score">0</span></div>
                <div class="score-item">æœ€é«˜åˆ†: <span id="highScore">0</span></div>
            </div>
            
            <button class="btn" id="pauseBtn" aria-label="æš‚åœæ¸¸æˆ">æš‚åœ</button>
            <button class="btn danger" id="restartBtn" aria-label="é‡æ–°å¼€å§‹">é‡æ–°å¼€å§‹</button>
            <button class="btn" id="clearScoreBtn" aria-label="æ¸…ç©ºæœ€é«˜åˆ†">æ¸…ç©ºè®°å½•</button>
        </div>

        <div class="canvas-container">
            <canvas id="gameCanvas" width="400" height="400"></canvas>
            <div class="game-status" id="gameStatus">å‡†å¤‡å¼€å§‹</div>
            <div class="particles" id="particles"></div>
            <div class="game-over" id="gameOver">
                <h2>æ¸¸æˆç»“æŸ!</h2>
                <p>æœ¬å±€å¾—åˆ†: <span id="finalScore">0</span></p>
                <p>æœ€é«˜åˆ†: <span id="finalHighScore">0</span></p>
                <button class="btn success" id="restartBtn2" aria-label="é‡æ–°å¼€å§‹æ¸¸æˆ">ğŸ® é‡æ–°å¼€å§‹</button>
            </div>
        </div>

        <div class="settings">
            <div class="setting-group">
                <label for="gridSize">ç½‘æ ¼å¤§å°:</label>
                <select id="gridSize">
                    <option value="16">16Ã—16</option>
                    <option value="20" selected>20Ã—20</option>
                    <option value="24">24Ã—24</option>
                </select>
            </div>

            <div class="setting-group">
                <label for="wallMode">è¾¹ç•Œæ¨¡å¼:</label>
                <select id="wallMode">
                    <option value="wall">æ’å¢™å³æ­»</option>
                    <option value="wrap">ç©¿å¢™æ¨¡å¼</option>
                </select>
            </div>

            <div class="setting-group">
                <label for="gameSpeed">åˆå§‹é€Ÿåº¦:</label>
                <select id="gameSpeed">
                    <option value="200">æ…¢é€Ÿ</option>
                    <option value="150" selected>ä¸­é€Ÿ</option>
                    <option value="100">å¿«é€Ÿ</option>
                    <option value="80">æé€Ÿ</option>
                </select>
            </div>
        </div>

        <div class="instructions">
            <button class="instructions-toggle" id="instructionsToggle">ğŸ“– ä½¿ç”¨è¯´æ˜</button>
            <div class="instructions-content" id="instructionsContent">
                <h3>æ“ä½œæ–¹å¼:</h3>
                <p>â€¢ æ¡Œé¢ç«¯: æ–¹å‘é”® â†‘â†“â†â†’ æˆ– WASD æ§åˆ¶æ–¹å‘</p>
                <p>â€¢ ç§»åŠ¨ç«¯: åœ¨å±å¹•ä¸Šæ»‘åŠ¨æ§åˆ¶æ–¹å‘</p>
                <p>â€¢ ç©ºæ ¼é”®: æš‚åœ/ç»§ç»­æ¸¸æˆ</p>
                
                <h3>æ¸¸æˆè§„åˆ™:</h3>
                <p>â€¢ æ§åˆ¶è›‡åƒé£Ÿç‰©ï¼Œæ¯åƒä¸€ä¸ªé£Ÿç‰©å¾—10åˆ†å¹¶å¢é•¿</p>
                <p>â€¢ æ’åˆ°è‡ªå·±æˆ–å¢™å£(æ’å¢™æ¨¡å¼ä¸‹)æ¸¸æˆç»“æŸ</p>
                <p>â€¢ æ¯åƒ5ä¸ªé£Ÿç‰©é€Ÿåº¦ä¼šå¢åŠ </p>
                
                <h3>è®¾ç½®è¯´æ˜:</h3>
                <p>â€¢ ç½‘æ ¼å¤§å°: æ”¹å˜æ¸¸æˆåŒºåŸŸå¤§å°</p>
                <p>â€¢ è¾¹ç•Œæ¨¡å¼: é€‰æ‹©æ’å¢™æ­»äº¡æˆ–ç©¿å¢™ä¼ é€</p>
                <p>â€¢ åˆå§‹é€Ÿåº¦: è®¾ç½®æ¸¸æˆå¼€å§‹æ—¶çš„ç§»åŠ¨é€Ÿåº¦</p>
                <p>â€¢ æ¸…ç©ºè®°å½•: é‡ç½®æœ€é«˜åˆ†è®°å½•</p>
            </div>
        </div>
    </div>

    <script>
        // ==================== æ¸¸æˆé…ç½®å¸¸é‡ ====================
        const CONFIG = {
            INITIAL_SPEED: 150,        // åˆå§‹é€Ÿåº¦(ms)
            SPEED_INCREASE: 10,        // æ¯æ¬¡åŠ é€Ÿå‡å°‘çš„ms
            MIN_SPEED: 80,             // æœ€å°é€Ÿåº¦(ms)
            FOODS_PER_SPEED_UP: 5,     // æ¯åƒå‡ ä¸ªé£Ÿç‰©åŠ é€Ÿä¸€æ¬¡
            POINTS_PER_FOOD: 10        // æ¯ä¸ªé£Ÿç‰©çš„åˆ†æ•°
        };

        // ==================== éŸ³æ•ˆç®¡ç†å™¨ ====================
        class SoundManager {
            constructor() {
                this.enabled = localStorage.getItem('soundEnabled') !== 'false';
                this.audioContext = null;
                this.initAudioContext();
            }

            // åˆå§‹åŒ–éŸ³é¢‘ä¸Šä¸‹æ–‡
            initAudioContext() {
                try {
                    this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                } catch (e) {
                    console.warn('éŸ³é¢‘ä¸Šä¸‹æ–‡åˆå§‹åŒ–å¤±è´¥:', e);
                }
            }

            // æ’­æ”¾éŸ³æ•ˆ
            playSound(frequency, duration, type = 'sine', volume = 0.1) {
                if (!this.enabled || !this.audioContext) return;

                try {
                    const oscillator = this.audioContext.createOscillator();
                    const gainNode = this.audioContext.createGain();

                    oscillator.connect(gainNode);
                    gainNode.connect(this.audioContext.destination);

                    oscillator.frequency.setValueAtTime(frequency, this.audioContext.currentTime);
                    oscillator.type = type;

                    gainNode.gain.setValueAtTime(0, this.audioContext.currentTime);
                    gainNode.gain.linearRampToValueAtTime(volume, this.audioContext.currentTime + 0.01);
                    gainNode.gain.exponentialRampToValueAtTime(0.001, this.audioContext.currentTime + duration);

                    oscillator.start(this.audioContext.currentTime);
                    oscillator.stop(this.audioContext.currentTime + duration);
                } catch (e) {
                    console.warn('éŸ³æ•ˆæ’­æ”¾å¤±è´¥:', e);
                }
            }

            // æ’­æ”¾åƒé£Ÿç‰©éŸ³æ•ˆ
            playEatSound() {
                this.playSound(800, 0.1, 'square', 0.15);
                setTimeout(() => this.playSound(1000, 0.1, 'square', 0.1), 50);
            }

            // æ’­æ”¾æ¸¸æˆç»“æŸéŸ³æ•ˆ
            playGameOverSound() {
                this.playSound(200, 0.3, 'sawtooth', 0.2);
                setTimeout(() => this.playSound(150, 0.3, 'sawtooth', 0.15), 150);
                setTimeout(() => this.playSound(100, 0.5, 'sawtooth', 0.1), 300);
            }

            // æ’­æ”¾ç§»åŠ¨éŸ³æ•ˆ
            playMoveSound() {
                this.playSound(300, 0.05, 'triangle', 0.05);
            }

            // æ’­æ”¾æŒ‰é’®ç‚¹å‡»éŸ³æ•ˆ
            playClickSound() {
                this.playSound(600, 0.1, 'sine', 0.1);
            }

            // åˆ‡æ¢éŸ³æ•ˆå¼€å…³
            toggle() {
                this.enabled = !this.enabled;
                localStorage.setItem('soundEnabled', this.enabled);
                return this.enabled;
            }

            // è·å–éŸ³æ•ˆçŠ¶æ€
            isEnabled() {
                return this.enabled;
            }
        }

        // ==================== ä¸»æ¸¸æˆç±» ====================
        class SnakeGame {
            constructor() {
                // ç”»å¸ƒå’Œæ¸²æŸ“ç›¸å…³
                this.canvas = document.getElementById('gameCanvas');
                this.ctx = this.canvas.getContext('2d');
                this.gridSize = 20;
                this.tileCount = 20;
                this.wallMode = 'wall'; // 'wall' or 'wrap'

                // æ¸¸æˆå¯¹è±¡çŠ¶æ€
                this.snake = [{x: 10, y: 10}];
                this.food = {x: 15, y: 15};
                this.dx = 0;  // å½“å‰æ°´å¹³ç§»åŠ¨æ–¹å‘
                this.dy = 0;  // å½“å‰å‚ç›´ç§»åŠ¨æ–¹å‘
                this.nextDirection = {dx: 0, dy: 0}; // ä¸‹ä¸€ä¸ªç§»åŠ¨æ–¹å‘ï¼ˆé˜²æ­¢å¿«é€ŸæŒ‰é”®å¯¼è‡´åå‘ï¼‰

                // æ¸¸æˆçŠ¶æ€
                this.score = 0;
                this.speed = 1;
                this.gameRunning = false;
                this.gamePaused = false;
                this.lastTime = 0;
                this.gameSpeed = CONFIG.INITIAL_SPEED;
                this.initialSpeed = CONFIG.INITIAL_SPEED; // ä¿å­˜åˆå§‹é€Ÿåº¦è®¾ç½®

                // è§¦æ‘¸æ§åˆ¶ç›¸å…³
                this.touchStartX = 0;
                this.touchStartY = 0;

                // éŸ³æ•ˆç®¡ç†å™¨
                this.soundManager = new SoundManager();

                // ç²’å­æ•ˆæœ
                this.particles = [];

                // åˆå§‹åŒ–æ¸¸æˆ
                this.initializeGame();
                this.setupEventListeners();
                this.loadSettings();
                this.updateDisplay();
                this.updateSoundButton();
            }

            // ==================== åˆå§‹åŒ–æ–¹æ³• ====================

            // åˆå§‹åŒ–æ¸¸æˆ
            initializeGame() {
                this.resizeCanvas();
                this.generateFood();
                this.draw();
                this.updateGameStatus('å‡†å¤‡å¼€å§‹');
            }

            // è°ƒæ•´ç”»å¸ƒå¤§å°ä»¥é€‚åº”å®¹å™¨
            resizeCanvas() {
                const container = this.canvas.parentElement;
                const maxSize = Math.min(container.clientWidth - 40, container.clientHeight - 40, 500);
                this.canvas.width = maxSize;
                this.canvas.height = maxSize;
                this.gridSize = maxSize / this.tileCount;
            }

            // ==================== äº‹ä»¶ç›‘å¬å™¨è®¾ç½® ====================

            setupEventListeners() {
                // é”®ç›˜äº‹ä»¶ç›‘å¬
                document.addEventListener('keydown', (e) => this.handleKeyPress(e));

                // è§¦æ‘¸äº‹ä»¶ç›‘å¬ï¼ˆç§»åŠ¨ç«¯æ”¯æŒï¼‰
                this.canvas.addEventListener('touchstart', (e) => this.handleTouchStart(e), {passive: false});
                this.canvas.addEventListener('touchmove', (e) => e.preventDefault(), {passive: false});
                this.canvas.addEventListener('touchend', (e) => this.handleTouchEnd(e), {passive: false});

                // æ¸¸æˆæ§åˆ¶æŒ‰é’®äº‹ä»¶
                document.getElementById('pauseBtn').addEventListener('click', () => {
                    this.soundManager.playClickSound();
                    this.togglePause();
                });
                document.getElementById('restartBtn').addEventListener('click', () => {
                    this.soundManager.playClickSound();
                    this.restart();
                });
                document.getElementById('restartBtn2').addEventListener('click', () => {
                    this.soundManager.playClickSound();
                    this.restart();
                });
                document.getElementById('clearScoreBtn').addEventListener('click', () => {
                    this.soundManager.playClickSound();
                    this.clearHighScore();
                });

                // éŸ³æ•ˆå¼€å…³æŒ‰é’®
                document.getElementById('soundToggle').addEventListener('click', () => this.toggleSound());

                // æ¸¸æˆè®¾ç½®äº‹ä»¶
                document.getElementById('gridSize').addEventListener('change', (e) => {
                    this.soundManager.playClickSound();
                    this.changeGridSize(e.target.value);
                });
                document.getElementById('wallMode').addEventListener('change', (e) => {
                    this.soundManager.playClickSound();
                    this.changeWallMode(e.target.value);
                });
                document.getElementById('gameSpeed').addEventListener('change', (e) => {
                    this.soundManager.playClickSound();
                    this.changeGameSpeed(e.target.value);
                });

                // ä½¿ç”¨è¯´æ˜åˆ‡æ¢
                document.getElementById('instructionsToggle').addEventListener('click', () => {
                    this.soundManager.playClickSound();
                    this.toggleInstructions();
                });

                // çª—å£å¤§å°å˜åŒ–äº‹ä»¶
                window.addEventListener('resize', () => this.resizeCanvas());
            }

            // ==================== è¾“å…¥å¤„ç†æ–¹æ³• ====================

            // å¤„ç†é”®ç›˜è¾“å…¥
            handleKeyPress(e) {
                // ç©ºæ ¼é”®æ§åˆ¶æš‚åœ/ç»§ç»­
                if (e.code === 'Space') {
                    e.preventDefault();
                    this.soundManager.playClickSound();
                    this.togglePause();
                    return;
                }

                // æ¸¸æˆæœªè¿è¡Œæˆ–æš‚åœæ—¶ä¸å¤„ç†æ–¹å‘é”®
                if (!this.gameRunning || this.gamePaused) return;

                let newDx = this.dx, newDy = this.dy;

                // æ ¹æ®æŒ‰é”®è®¾ç½®æ–°æ–¹å‘ï¼ˆé˜²æ­¢180åº¦è½¬å‘ï¼‰
                switch(e.key) {
                    case 'ArrowUp':
                    case 'w':
                    case 'W':
                        if (this.dy !== 1) { newDx = 0; newDy = -1; }
                        break;
                    case 'ArrowDown':
                    case 's':
                    case 'S':
                        if (this.dy !== -1) { newDx = 0; newDy = 1; }
                        break;
                    case 'ArrowLeft':
                    case 'a':
                    case 'A':
                        if (this.dx !== 1) { newDx = -1; newDy = 0; }
                        break;
                    case 'ArrowRight':
                    case 'd':
                    case 'D':
                        if (this.dx !== -1) { newDx = 1; newDy = 0; }
                        break;
                }

                // åªæœ‰æ–¹å‘æ”¹å˜æ—¶æ‰æ›´æ–°ä¸‹ä¸€ä¸ªæ–¹å‘
                if (newDx !== this.dx || newDy !== this.dy) {
                    this.nextDirection = {dx: newDx, dy: newDy};
                }
            }

            // å¤„ç†è§¦æ‘¸å¼€å§‹äº‹ä»¶
            handleTouchStart(e) {
                e.preventDefault();
                const touch = e.touches[0];
                this.touchStartX = touch.clientX;
                this.touchStartY = touch.clientY;
            }

            // å¤„ç†è§¦æ‘¸ç»“æŸäº‹ä»¶ï¼ˆæ»‘åŠ¨æ‰‹åŠ¿è¯†åˆ«ï¼‰
            handleTouchEnd(e) {
                e.preventDefault();

                // å¦‚æœæ¸¸æˆæœªè¿è¡Œï¼Œç‚¹å‡»å¼€å§‹æ¸¸æˆ
                if (!this.gameRunning || this.gamePaused) {
                    if (!this.gameRunning) {
                        this.soundManager.playClickSound();
                        this.start();
                    }
                    return;
                }

                const touch = e.changedTouches[0];
                const deltaX = touch.clientX - this.touchStartX;
                const deltaY = touch.clientY - this.touchStartY;
                const minSwipeDistance = 30; // æœ€å°æ»‘åŠ¨è·ç¦»

                // æ»‘åŠ¨è·ç¦»ä¸å¤Ÿï¼Œå¿½ç•¥
                if (Math.abs(deltaX) < minSwipeDistance && Math.abs(deltaY) < minSwipeDistance) return;

                let newDx = this.dx, newDy = this.dy;

                // åˆ¤æ–­æ»‘åŠ¨æ–¹å‘ï¼ˆæ°´å¹³æˆ–å‚ç›´ï¼‰
                if (Math.abs(deltaX) > Math.abs(deltaY)) {
                    // æ°´å¹³æ»‘åŠ¨
                    if (deltaX > 0 && this.dx !== -1) { newDx = 1; newDy = 0; }      // å‘å³
                    else if (deltaX < 0 && this.dx !== 1) { newDx = -1; newDy = 0; } // å‘å·¦
                } else {
                    // å‚ç›´æ»‘åŠ¨
                    if (deltaY > 0 && this.dy !== -1) { newDx = 0; newDy = 1; }      // å‘ä¸‹
                    else if (deltaY < 0 && this.dy !== 1) { newDx = 0; newDy = -1; } // å‘ä¸Š
                }

                // åªæœ‰æ–¹å‘æ”¹å˜æ—¶æ‰æ›´æ–°
                if (newDx !== this.dx || newDy !== this.dy) {
                    this.nextDirection = {dx: newDx, dy: newDy};
                }
            }

            // ==================== æ¸¸æˆæ§åˆ¶æ–¹æ³• ====================

            // å¼€å§‹æ¸¸æˆ
            start() {
                if (this.gameRunning) return;

                this.gameRunning = true;
                this.gamePaused = false;
                this.dx = 1;  // åˆå§‹å‘å³ç§»åŠ¨
                this.dy = 0;
                this.nextDirection = {dx: 1, dy: 0};

                // æ›´æ–°UI
                document.getElementById('pauseBtn').textContent = 'æš‚åœ';
                document.getElementById('gameOver').style.display = 'none';
                this.updateGameStatus('æ¸¸æˆè¿›è¡Œä¸­', 'playing');

                // å¼€å§‹æ¸¸æˆå¾ªç¯
                this.gameLoop();
            }

            // åˆ‡æ¢æš‚åœçŠ¶æ€
            togglePause() {
                if (!this.gameRunning) {
                    this.start();
                    return;
                }

                this.gamePaused = !this.gamePaused;
                document.getElementById('pauseBtn').textContent = this.gamePaused ? 'ç»§ç»­' : 'æš‚åœ';

                // æ›´æ–°æ¸¸æˆçŠ¶æ€æ˜¾ç¤º
                if (this.gamePaused) {
                    this.updateGameStatus('æ¸¸æˆæš‚åœ', 'paused');
                } else {
                    this.updateGameStatus('æ¸¸æˆè¿›è¡Œä¸­', 'playing');
                    this.gameLoop(); // ç»§ç»­æ¸¸æˆå¾ªç¯
                }
            }

            // é‡æ–°å¼€å§‹æ¸¸æˆ
            restart() {
                // é‡ç½®æ¸¸æˆçŠ¶æ€
                this.gameRunning = false;
                this.gamePaused = false;
                this.snake = [{x: 10, y: 10}]; // é‡ç½®è›‡çš„ä½ç½®
                this.dx = 0;
                this.dy = 0;
                this.nextDirection = {dx: 0, dy: 0};
                this.score = 0;
                this.speed = 1;
                this.gameSpeed = this.initialSpeed; // ä½¿ç”¨è®¾ç½®çš„åˆå§‹é€Ÿåº¦

                // æ¸…ç©ºç²’å­æ•ˆæœ
                this.particles = [];
                this.clearParticles();

                // é‡æ–°ç”Ÿæˆé£Ÿç‰©å’Œæ›´æ–°æ˜¾ç¤º
                this.generateFood();
                this.updateDisplay();
                this.draw();

                // æ›´æ–°UIçŠ¶æ€
                document.getElementById('pauseBtn').textContent = 'å¼€å§‹';
                document.getElementById('gameOver').style.display = 'none';
                this.updateGameStatus('å‡†å¤‡å¼€å§‹');
            }

            // ==================== æ¸¸æˆå¾ªç¯ ====================

            // ä¸»æ¸¸æˆå¾ªç¯
            gameLoop() {
                if (!this.gameRunning || this.gamePaused) return;

                const currentTime = Date.now();
                // æ ¹æ®æ¸¸æˆé€Ÿåº¦æ§åˆ¶æ›´æ–°é¢‘ç‡
                if (currentTime - this.lastTime >= this.gameSpeed) {
                    this.update();      // æ›´æ–°æ¸¸æˆé€»è¾‘
                    this.draw();        // ç»˜åˆ¶æ¸¸æˆç”»é¢
                    this.lastTime = currentTime;
                }

                // ä½¿ç”¨requestAnimationFrameå®ç°å¹³æ»‘åŠ¨ç”»
                requestAnimationFrame(() => this.gameLoop());
            }

            // ==================== æ¸¸æˆé€»è¾‘æ›´æ–° ====================

            // æ›´æ–°æ¸¸æˆçŠ¶æ€
            update() {
                // åº”ç”¨ä¸‹ä¸€ä¸ªç§»åŠ¨æ–¹å‘ï¼ˆé˜²æ­¢å¿«é€ŸæŒ‰é”®å¯¼è‡´çš„åå‘ç§»åŠ¨ï¼‰
                this.dx = this.nextDirection.dx;
                this.dy = this.nextDirection.dy;

                // è®¡ç®—è›‡å¤´çš„æ–°ä½ç½®
                const head = {x: this.snake[0].x + this.dx, y: this.snake[0].y + this.dy};

                // è¾¹ç•Œå¤„ç†é€»è¾‘
                if (this.wallMode === 'wrap') {
                    // ç©¿å¢™æ¨¡å¼ï¼šä»ä¸€è¾¹ç©¿å‡ºåˆ°å¦ä¸€è¾¹
                    if (head.x < 0) head.x = this.tileCount - 1;
                    if (head.x >= this.tileCount) head.x = 0;
                    if (head.y < 0) head.y = this.tileCount - 1;
                    if (head.y >= this.tileCount) head.y = 0;
                } else {
                    // æ’å¢™æ¨¡å¼ï¼šç¢°åˆ°è¾¹ç•Œå°±æ¸¸æˆç»“æŸ
                    if (head.x < 0 || head.x >= this.tileCount || head.y < 0 || head.y >= this.tileCount) {
                        this.gameOver();
                        return;
                    }
                }

                // æ£€æŸ¥æ˜¯å¦æ’åˆ°è‡ªå·±
                if (this.snake.some(segment => segment.x === head.x && segment.y === head.y)) {
                    this.gameOver();
                    return;
                }

                // å°†æ–°å¤´éƒ¨æ·»åŠ åˆ°è›‡èº«
                this.snake.unshift(head);

                // æ£€æŸ¥æ˜¯å¦åƒåˆ°é£Ÿç‰©
                if (head.x === this.food.x && head.y === this.food.y) {
                    // åƒåˆ°é£Ÿç‰©ï¼šå¢åŠ åˆ†æ•°ï¼Œæ’­æ”¾éŸ³æ•ˆï¼Œåˆ›å»ºç²’å­æ•ˆæœ
                    this.score += CONFIG.POINTS_PER_FOOD;
                    this.soundManager.playEatSound();
                    this.createFoodParticles(this.food.x, this.food.y);
                    this.highlightScore();

                    // æ£€æŸ¥æ˜¯å¦éœ€è¦å¢åŠ é€Ÿåº¦
                    if (this.score % (CONFIG.FOODS_PER_SPEED_UP * CONFIG.POINTS_PER_FOOD) === 0) {
                        this.gameSpeed = Math.max(this.gameSpeed - CONFIG.SPEED_INCREASE, CONFIG.MIN_SPEED);
                        this.speed = Math.floor((this.initialSpeed - this.gameSpeed) / CONFIG.SPEED_INCREASE) + 1;
                    }

                    this.generateFood();
                    this.updateDisplay();
                } else {
                    // æ²¡åƒåˆ°é£Ÿç‰©ï¼šç§»é™¤å°¾éƒ¨ï¼ˆä¿æŒé•¿åº¦ä¸å˜ï¼‰
                    this.snake.pop();
                    // æ’­æ”¾ç§»åŠ¨éŸ³æ•ˆï¼ˆé¢‘ç‡è¾ƒä½ï¼‰
                    if (Math.random() < 0.1) this.soundManager.playMoveSound();
                }
            }

            // ==================== é£Ÿç‰©ç”Ÿæˆ ====================

            // ç”Ÿæˆæ–°çš„é£Ÿç‰©ä½ç½®
            generateFood() {
                let attempts = 0;
                do {
                    // éšæœºç”Ÿæˆé£Ÿç‰©åæ ‡
                    this.food = {
                        x: Math.floor(Math.random() * this.tileCount),
                        y: Math.floor(Math.random() * this.tileCount)
                    };
                    attempts++;
                    // ç¡®ä¿é£Ÿç‰©ä¸ä¼šç”Ÿæˆåœ¨è›‡èº«ä¸Šï¼Œæœ€å¤šå°è¯•100æ¬¡
                } while (this.snake.some(segment => segment.x === this.food.x && segment.y === this.food.y) && attempts < 100);
            }

            // ==================== ç»˜åˆ¶æ–¹æ³• ====================

            // ç»˜åˆ¶æ¸¸æˆç”»é¢
            draw() {
                // æ¸…ç©ºç”»å¸ƒï¼Œè®¾ç½®èƒŒæ™¯è‰²
                this.ctx.fillStyle = '#f7fafc';
                this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);

                // ç»˜åˆ¶ç½‘æ ¼çº¿
                this.drawGrid();

                // ç»˜åˆ¶è›‡èº«
                this.drawSnake();

                // ç»˜åˆ¶é£Ÿç‰©
                this.drawFood();

                // æ›´æ–°ç²’å­æ•ˆæœ
                this.updateParticles();
            }

            // ç»˜åˆ¶ç½‘æ ¼çº¿
            drawGrid() {
                this.ctx.strokeStyle = '#e2e8f0';
                this.ctx.lineWidth = 1;
                this.ctx.globalAlpha = 0.5;

                for (let i = 0; i <= this.tileCount; i++) {
                    const pos = i * this.gridSize;
                    this.ctx.beginPath();
                    this.ctx.moveTo(pos, 0);
                    this.ctx.lineTo(pos, this.canvas.height);
                    this.ctx.moveTo(0, pos);
                    this.ctx.lineTo(this.canvas.width, pos);
                    this.ctx.stroke();
                }

                this.ctx.globalAlpha = 1;
            }

            // ç»˜åˆ¶è›‡èº«
            drawSnake() {
                this.snake.forEach((segment, index) => {
                    const x = segment.x * this.gridSize + 1;
                    const y = segment.y * this.gridSize + 1;
                    const size = this.gridSize - 2;

                    if (index === 0) {
                        // ç»˜åˆ¶è›‡å¤´ï¼ˆå¸¦æ¸å˜æ•ˆæœï¼‰
                        const gradient = this.ctx.createLinearGradient(x, y, x + size, y + size);
                        gradient.addColorStop(0, '#2d5a27');
                        gradient.addColorStop(1, '#1a3d1a');
                        this.ctx.fillStyle = gradient;

                        // è›‡å¤´ç¨å¾®å¤§ä¸€ç‚¹
                        this.ctx.fillRect(x - 1, y - 1, size + 2, size + 2);

                        // ç»˜åˆ¶çœ¼ç›
                        this.ctx.fillStyle = '#ffffff';
                        const eyeSize = 2;
                        this.ctx.fillRect(x + size * 0.3, y + size * 0.3, eyeSize, eyeSize);
                        this.ctx.fillRect(x + size * 0.7, y + size * 0.3, eyeSize, eyeSize);
                    } else {
                        // ç»˜åˆ¶è›‡èº«ï¼ˆå¸¦é€æ˜åº¦æ¸å˜ï¼‰
                        const alpha = Math.max(0.6, 1 - index * 0.05);
                        this.ctx.globalAlpha = alpha;

                        const gradient = this.ctx.createLinearGradient(x, y, x + size, y + size);
                        gradient.addColorStop(0, '#48bb78');
                        gradient.addColorStop(1, '#38a169');
                        this.ctx.fillStyle = gradient;

                        this.ctx.fillRect(x, y, size, size);
                        this.ctx.globalAlpha = 1;
                    }
                });
            }

            // ç»˜åˆ¶é£Ÿç‰©
            drawFood() {
                const centerX = this.food.x * this.gridSize + this.gridSize / 2;
                const centerY = this.food.y * this.gridSize + this.gridSize / 2;
                const radius = this.gridSize / 2 - 2;

                // é£Ÿç‰©å‘å…‰æ•ˆæœ
                const gradient = this.ctx.createRadialGradient(centerX, centerY, 0, centerX, centerY, radius);
                gradient.addColorStop(0, '#ff6b6b');
                gradient.addColorStop(0.7, '#e53e3e');
                gradient.addColorStop(1, '#c53030');

                this.ctx.fillStyle = gradient;
                this.ctx.beginPath();
                this.ctx.arc(centerX, centerY, radius, 0, 2 * Math.PI);
                this.ctx.fill();

                // é£Ÿç‰©é—ªçƒæ•ˆæœï¼ˆå¯é€‰ï¼‰
                if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                    const time = Date.now() * 0.005;
                    const pulse = Math.sin(time) * 0.1 + 0.9;
                    this.ctx.globalAlpha = pulse;

                    this.ctx.fillStyle = '#ffffff';
                    this.ctx.beginPath();
                    this.ctx.arc(centerX, centerY, radius * 0.5, 0, 2 * Math.PI);
                    this.ctx.fill();

                    this.ctx.globalAlpha = 1;
                }
            }

            // ==================== ç²’å­æ•ˆæœç³»ç»Ÿ ====================

            // åˆ›å»ºé£Ÿç‰©è¢«åƒæ—¶çš„ç²’å­æ•ˆæœ
            createFoodParticles(x, y) {
                const particleCount = 8;
                const centerX = x * this.gridSize + this.gridSize / 2;
                const centerY = y * this.gridSize + this.gridSize / 2;

                for (let i = 0; i < particleCount; i++) {
                    const angle = (i / particleCount) * Math.PI * 2;
                    const speed = 2 + Math.random() * 3;

                    this.particles.push({
                        x: centerX,
                        y: centerY,
                        vx: Math.cos(angle) * speed,
                        vy: Math.sin(angle) * speed,
                        life: 1,
                        decay: 0.02 + Math.random() * 0.02,
                        color: `hsl(${120 + Math.random() * 60}, 70%, 60%)`
                    });
                }
            }

            // æ›´æ–°ç²’å­æ•ˆæœ
            updateParticles() {
                const particlesContainer = document.getElementById('particles');

                // æ¸…é™¤æ—§ç²’å­DOMå…ƒç´ 
                particlesContainer.innerHTML = '';

                // æ›´æ–°ç²’å­çŠ¶æ€å¹¶åˆ›å»ºDOMå…ƒç´ 
                this.particles = this.particles.filter(particle => {
                    particle.x += particle.vx;
                    particle.y += particle.vy;
                    particle.life -= particle.decay;
                    particle.vy += 0.1; // é‡åŠ›æ•ˆæœ

                    if (particle.life > 0) {
                        // åˆ›å»ºç²’å­DOMå…ƒç´ 
                        const particleElement = document.createElement('div');
                        particleElement.className = 'particle';
                        particleElement.style.left = particle.x + 'px';
                        particleElement.style.top = particle.y + 'px';
                        particleElement.style.background = particle.color;
                        particleElement.style.opacity = particle.life;
                        particleElement.style.transform = `scale(${particle.life})`;
                        particlesContainer.appendChild(particleElement);

                        return true;
                    }
                    return false;
                });
            }

            // æ¸…é™¤æ‰€æœ‰ç²’å­
            clearParticles() {
                document.getElementById('particles').innerHTML = '';
            }

            // ==================== æ¸¸æˆç»“æŸå¤„ç† ====================

            // æ¸¸æˆç»“æŸ
            gameOver() {
                this.gameRunning = false;

                // æ’­æ”¾æ¸¸æˆç»“æŸéŸ³æ•ˆ
                this.soundManager.playGameOverSound();

                // æ›´æ–°æœ€é«˜åˆ†
                const highScore = this.getHighScore();
                if (this.score > highScore) {
                    localStorage.setItem('snakeHighScore', this.score.toString());
                }

                // æ˜¾ç¤ºæ¸¸æˆç»“æŸç•Œé¢
                document.getElementById('finalScore').textContent = this.score;
                document.getElementById('finalHighScore').textContent = Math.max(this.score, highScore);
                document.getElementById('gameOver').style.display = 'flex';

                // æ›´æ–°æ¸¸æˆçŠ¶æ€
                this.updateGameStatus('æ¸¸æˆç»“æŸ');
                this.updateDisplay();
            }

            // ==================== æ•°æ®ç®¡ç†æ–¹æ³• ====================

            // è·å–æœ€é«˜åˆ†
            getHighScore() {
                return parseInt(localStorage.getItem('snakeHighScore') || '0');
            }

            // æ¸…ç©ºæœ€é«˜åˆ†è®°å½•
            clearHighScore() {
                localStorage.removeItem('snakeHighScore');
                this.updateDisplay();
            }

            // æ›´æ–°æ˜¾ç¤ºä¿¡æ¯
            updateDisplay() {
                document.getElementById('score').textContent = this.score;
                document.getElementById('highScore').textContent = this.getHighScore();
            }

            // é«˜äº®åˆ†æ•°æ˜¾ç¤ºï¼ˆåƒåˆ°é£Ÿç‰©æ—¶ï¼‰
            highlightScore() {
                const scoreItem = document.getElementById('scoreItem');
                scoreItem.classList.remove('highlight');
                // å¼ºåˆ¶é‡ç»˜
                scoreItem.offsetHeight;
                scoreItem.classList.add('highlight');

                // ç§»é™¤é«˜äº®ç±»
                setTimeout(() => {
                    scoreItem.classList.remove('highlight');
                }, 500);
            }

            // æ›´æ–°æ¸¸æˆçŠ¶æ€æ˜¾ç¤º
            updateGameStatus(text, className = '') {
                const statusElement = document.getElementById('gameStatus');
                statusElement.textContent = text;
                statusElement.className = 'game-status show ' + className;

                // 3ç§’åéšè—çŠ¶æ€
                setTimeout(() => {
                    statusElement.classList.remove('show');
                }, 3000);
            }

            // ==================== éŸ³æ•ˆæ§åˆ¶ ====================

            // åˆ‡æ¢éŸ³æ•ˆå¼€å…³
            toggleSound() {
                const enabled = this.soundManager.toggle();
                this.updateSoundButton();

                // æ’­æ”¾æµ‹è¯•éŸ³æ•ˆ
                if (enabled) {
                    this.soundManager.playClickSound();
                }
            }

            // æ›´æ–°éŸ³æ•ˆæŒ‰é’®æ˜¾ç¤º
            updateSoundButton() {
                const button = document.getElementById('soundToggle');
                button.textContent = this.soundManager.isEnabled() ? 'ğŸ”Š' : 'ğŸ”‡';
                button.title = this.soundManager.isEnabled() ? 'å…³é—­éŸ³æ•ˆ' : 'å¼€å¯éŸ³æ•ˆ';
            }

            // ==================== è®¾ç½®ç®¡ç†æ–¹æ³• ====================

            // æ”¹å˜ç½‘æ ¼å¤§å°
            changeGridSize(size) {
                this.tileCount = parseInt(size);
                this.saveSettings();
                this.resizeCanvas();
                this.restart(); // é‡æ–°å¼€å§‹æ¸¸æˆä»¥åº”ç”¨æ–°è®¾ç½®
            }

            // æ”¹å˜è¾¹ç•Œæ¨¡å¼
            changeWallMode(mode) {
                this.wallMode = mode;
                this.saveSettings();
            }

            // æ”¹å˜æ¸¸æˆé€Ÿåº¦
            changeGameSpeed(speed) {
                this.initialSpeed = parseInt(speed);
                this.saveSettings();

                // å¦‚æœæ¸¸æˆæ­£åœ¨è¿è¡Œï¼Œé‡æ–°è®¡ç®—å½“å‰é€Ÿåº¦
                if (this.gameRunning) {
                    const speedLevel = Math.floor((this.initialSpeed - this.gameSpeed) / CONFIG.SPEED_INCREASE);
                    this.gameSpeed = Math.max(this.initialSpeed - speedLevel * CONFIG.SPEED_INCREASE, CONFIG.MIN_SPEED);
                } else {
                    this.gameSpeed = this.initialSpeed;
                }
            }

            // ä¿å­˜è®¾ç½®åˆ°æœ¬åœ°å­˜å‚¨
            saveSettings() {
                const settings = {
                    gridSize: this.tileCount,
                    wallMode: this.wallMode,
                    gameSpeed: this.initialSpeed
                };
                localStorage.setItem('snakeSettings', JSON.stringify(settings));
            }

            // ä»æœ¬åœ°å­˜å‚¨åŠ è½½è®¾ç½®
            loadSettings() {
                const settings = JSON.parse(localStorage.getItem('snakeSettings') || '{}');

                // åŠ è½½ç½‘æ ¼å¤§å°è®¾ç½®
                if (settings.gridSize) {
                    this.tileCount = settings.gridSize;
                    document.getElementById('gridSize').value = settings.gridSize;
                }

                // åŠ è½½è¾¹ç•Œæ¨¡å¼è®¾ç½®
                if (settings.wallMode) {
                    this.wallMode = settings.wallMode;
                    document.getElementById('wallMode').value = settings.wallMode;
                }

                // åŠ è½½æ¸¸æˆé€Ÿåº¦è®¾ç½®
                if (settings.gameSpeed) {
                    this.initialSpeed = settings.gameSpeed;
                    this.gameSpeed = settings.gameSpeed;
                    document.getElementById('gameSpeed').value = settings.gameSpeed;
                }

                this.resizeCanvas();
            }

            // ==================== UI äº¤äº’æ–¹æ³• ====================

            // åˆ‡æ¢ä½¿ç”¨è¯´æ˜æ˜¾ç¤º
            toggleInstructions() {
                const content = document.getElementById('instructionsContent');
                const toggle = document.getElementById('instructionsToggle');

                if (content.classList.contains('show')) {
                    content.classList.remove('show');
                    toggle.textContent = 'ğŸ“– ä½¿ç”¨è¯´æ˜';
                } else {
                    content.classList.add('show');
                    toggle.textContent = 'ğŸ“– éšè—è¯´æ˜';
                }
            }
        }

        // ==================== æ¸¸æˆåˆå§‹åŒ– ====================

        // åˆ›å»ºæ¸¸æˆå®ä¾‹å¹¶å¯åŠ¨
        const game = new SnakeGame();

        // ==================== å¯é€‰æ‰©å±•åŠŸèƒ½ TODO ====================
        /*
        æœªæ¥å¯ä»¥æ·»åŠ çš„åŠŸèƒ½ï¼š
        âœ… éŸ³æ•ˆç³»ç»Ÿ - å·²å®ç°
        âœ… ç²’å­æ•ˆæœ - å·²å®ç°
        âœ… ä¸°å¯Œçš„UIç•Œé¢ - å·²å®ç°
        âœ… è¯¦ç»†çš„ä»£ç æ³¨é‡Š - å·²å®ç°

        å¾…å®ç°åŠŸèƒ½ï¼š
        - ğŸ¨ å¤šç§çš®è‚¤ä¸»é¢˜ï¼ˆæ·±è‰²æ¨¡å¼ã€å½©è‰²ä¸»é¢˜ç­‰ï¼‰
        - ğŸš§ éšœç¢ç‰©ç³»ç»Ÿï¼ˆéšæœºç”Ÿæˆçš„å¢™å£ï¼‰
        - ğŸ é“å…·ç³»ç»Ÿï¼ˆåŠ é€Ÿé“å…·ã€å‡é€Ÿé“å…·ã€ç©¿å¢™é“å…·ç­‰ï¼‰
        - ğŸ‘¥ å¤šäººå¯¹æˆ˜æ¨¡å¼ï¼ˆæœ¬åœ°åŒäººæ¸¸æˆï¼‰
        - ğŸ† å…³å¡ç³»ç»Ÿï¼ˆä¸åŒéš¾åº¦ã€ç‰¹æ®ŠæŒ‘æˆ˜ï¼‰
        - ğŸ“Š æˆå°±ç³»ç»Ÿï¼ˆè¿ç»­åƒé£Ÿç‰©ã€è¾¾åˆ°ç‰¹å®šåˆ†æ•°ç­‰ï¼‰
        - ğŸµ èƒŒæ™¯éŸ³ä¹ï¼ˆå¯å¾ªç¯æ’­æ”¾çš„èƒŒæ™¯éŸ³ä¹ï¼‰
        - âŒ¨ï¸ è‡ªå®šä¹‰æ§åˆ¶é”®ä½
        - ğŸ“± æ›´å¥½çš„ç§»åŠ¨ç«¯ä½“éªŒï¼ˆè™šæ‹Ÿæ–¹å‘é”®ï¼‰
        - ğŸ’¾ äº‘ç«¯å­˜æ¡£ï¼ˆéœ€è¦åç«¯æ”¯æŒï¼‰
        - ğŸ”„ é‡æ’­ç³»ç»Ÿï¼ˆè®°å½•å¹¶å›æ”¾æ¸¸æˆè¿‡ç¨‹ï¼‰
        - ğŸ¯ AIå¯¹æ‰‹ï¼ˆç”µè„‘æ§åˆ¶çš„è›‡ï¼‰
        */
    </script>
</body>
</html>
